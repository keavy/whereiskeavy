<div id="location">
  <h2><%= @results[:location_str] %></h2>
  <p><span class='time'><%= @timezone.now.strftime('%I:%M %p') %></span> / <span class='weather'>Low: <%= @results[:low] %>&deg;F, High: <%= @results[:high] %>&deg;F</span></p>
</div>

<div id='map_canvas' style='width: 600px; height: 310px'>
</div>

<script type="text/javascript" charset="utf-8">
  var gmapMarkers = <%=
  output = [{:coordinate => @results[:lat_lng], :title => @results[:location_str]}]
  output.to_json
  %>

  function initGmap() {
    var bounds = new google.maps.LatLngBounds();
    for (var i = 0; i < gmapMarkers.length; i++) {
      var marker = gmapMarkers[i];
      bounds.extend(new google.maps.LatLng(marker.coordinate[0], marker.coordinate[1]));
    }
    var map = new google.maps.Map(document.getElementById("map_canvas"), {
      zoom: 3,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      disableDefaultUI: false,
      scrollwheel: false,
      center: bounds.getCenter()
    });
    for (var i = 0; i < gmapMarkers.length; i++) {
      var marker = gmapMarkers[i];
      new google.maps.Marker({position: new google.maps.LatLng(marker.coordinate[0], marker.coordinate[1]), map: map, clickable: true, title: marker.title});
    }
  }

  if (gmapMarkers.length > 0) {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://maps.google.com/maps/api/js?sensor=false&callback=initGmap";
    document.body.appendChild(script);
  }
</script>